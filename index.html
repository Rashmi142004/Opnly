import React, { useMemo, useState } from "react";

// Opnly – a calming, app-like SPA prototype (no backend)
// Theme: Lavender (#C8A2C8), Soft Purple (#BFA2DB), Off‑white (#F7F7F9), Dark Gray (#333333)
// Notes: Mobile‑first, rounded corners, soft shadows, smooth interactions.

const moodPills = {
  Anxiety: "Anxiety",
  Healing: "Healing",
  Grief: "Grief",
  Numb: "Numb",
  Hopeful: "Hopeful",
};

const seedPosts = [
  {
    id: 1,
    name: "Emma",
    avatar:
      "https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=80&h=80&fit=crop&crop=faces",
    time: "2 hours ago",
    text: "I feel overwhelmed by anxiety today.",
    mood: moodPills.Anxiety,
    likes: 36,
    comments: 12,
  },
  {
    id: 2,
    name: "Alex",
    avatar:
      "https://images.unsplash.com/photo-1531123897727-8f129e1688ce?q=80&w=80&h=80&fit=crop&crop=faces",
    time: "3 hours ago",
    text: "Opening up about my past has been healing.",
    mood: moodPills.Healing,
    likes: 24,
    comments: 5,
  },
  {
    id: 3,
    name: "Anonymous",
    avatar:
      "https://images.unsplash.com/photo-1511367461989-f85a21fda167?q=80&w=80&h=80&fit=crop&crop=faces",
    time: "yesterday",
    text: "Grief comes in waves. Writing helps me breathe through it.",
    mood: moodPills.Grief,
    likes: 58,
    comments: 19,
  },
];

function Badge({ children }) {
  return (
    <span className="inline-flex items-center rounded-full px-3 py-1 text-xs font-medium bg-white/70 text-[#333333] shadow-sm ring-1 ring-black/5">
      {children}
    </span>
  );
}

function IconHeart() {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-5 h-5">
      <path strokeWidth="2" d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78Z" />
    </svg>
  );
}

function IconComment() {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-5 h-5">
      <path strokeWidth="2" d="M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4v8Z" />
    </svg>
  );
}

function IconDots() {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="w-5 h-5">
      <circle cx="5" cy="12" r="2" />
      <circle cx="12" cy="12" r="2" />
      <circle cx="19" cy="12" r="2" />
    </svg>
  );
}

function IconPencil() {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-6 h-6">
      <path strokeWidth="2" d="M12 20h9" />
      <path strokeWidth="2" d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5Z" />
    </svg>
  );
}

function IconSearch() {
  return (
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" className="w-5 h-5">
      <circle cx="11" cy="11" r="7" strokeWidth="2" />
      <path d="m20 20-3-3" strokeWidth="2" />
    </svg>
  );
}

function Header({ onLogin, onSignup }) {
  return (
    <header className="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-white/60 bg-white/80 border-b border-black/5">
      <div className="mx-auto max-w-3xl px-4 py-3 flex items-center justify-between">
        <div className="text-2xl font-extrabold tracking-tight text-[#634B73]">Opnly</div>
        <div className="flex items-center gap-2">
          <button onClick={onLogin} className="px-3 py-2 rounded-xl text-sm font-medium bg-white text-[#333333] shadow-sm ring-1 ring-black/5 hover:shadow transition">Log In</button>
          <button onClick={onSignup} className="px-3 py-2 rounded-xl text-sm font-medium bg-[#A080A8] text-white shadow hover:shadow-md transition">Sign Up</button>
        </div>
      </div>
    </header>
  );
}

function Hero() {
  return (
    <section className="mx-auto max-w-3xl px-4 pt-8 pb-2">
      <h1 className="text-4xl md:text-5xl font-extrabold tracking-tight text-[#4E3B5B]">Speak. Heal. Connect.</h1>
      <p className="mt-3 text-[#333333]/80 leading-relaxed max-w-2xl">
        A safe space to share your trauma and find support.
      </p>
      <div className="mt-5 flex gap-3">
        <button className="px-4 py-2 rounded-2xl text-base font-semibold bg-[#C8A2C8] text-white shadow hover:shadow-md transition">Log In</button>
        <button className="px-4 py-2 rounded-2xl text-base font-semibold bg-white text-[#333333] ring-1 ring-black/5 shadow-sm hover:shadow transition">Sign Up</button>
      </div>
    </section>
  );
}

function SearchBar({ query, setQuery }) {
  return (
    <div className="relative">
      <div className="absolute inset-y-0 left-3 flex items-center pointer-events-none"><IconSearch /></div>
      <input
        value={query}
        onChange={(e) => setQuery(e.target.value)}
        placeholder="Search"
        className="w-full pl-11 pr-4 py-2 rounded-2xl bg-white/80 ring-1 ring-black/5 shadow-sm focus:outline-none focus:ring-2 focus:ring-[#BFA2DB]"
      />
    </div>
  );
}

function PostCard({ post, onReact }) {
  return (
    <article className="bg-white rounded-3xl shadow-sm ring-1 ring-black/5 p-4 md:p-5">
      <div className="flex items-start gap-3">
        <img src={post.avatar} alt={post.name} className="w-10 h-10 rounded-full object-cover" />
        <div className="flex-1 min-w-0">
          <div className="flex items-center justify-between">
            <div className="truncate">
              <div className="font-semibold text-[#333333] truncate">{post.name}</div>
              <div className="text-xs text-[#333333]/60">{post.time}</div>
            </div>
            <button className="text-[#333333]/50 hover:text-[#333333]/70 p-2"><IconDots /></button>
          </div>
          <p className="mt-3 text-[#333333] leading-relaxed">{post.text}</p>
          <div className="mt-3"><Badge>{post.mood}</Badge></div>
          <div className="mt-4 flex items-center gap-5 text-sm text-[#333333]/80">
            <button onClick={() => onReact(post.id, "like")} className="inline-flex items-center gap-2 hover:opacity-80">
              <IconHeart /> <span>{post.likes}</span>
            </button>
            <div className="inline-flex items-center gap-2">
              <IconComment /> <span>{post.comments}</span>
            </div>
          </div>
        </div>
      </div>
    </article>
  );
}

function Compose({ onClose, onSubmit }) {
  const [text, setText] = useState("");
  const [mood, setMood] = useState(moodPills.Anxiety);
  const [anon, setAnon] = useState(true);

  return (
    <div className="fixed inset-0 z-50 grid place-items-center p-4">
      <div className="absolute inset-0 bg-black/30" onClick={onClose} />
      <div className="relative w-full max-w-md rounded-3xl bg-white shadow-xl ring-1 ring-black/5 p-5">
        <h3 className="text-lg font-semibold text-[#333333]">Share how you feel</h3>
        <p className="text-sm text-[#333333]/70 mt-1">Anonymous by default. Be kind to yourself.</p>

        <textarea
          value={text}
          onChange={(e) => setText(e.target.value)}
          placeholder="Write your thoughts…"
          rows={5}
          className="mt-4 w-full resize-none rounded-2xl bg-[#F7F7F9] p-3 outline-none ring-1 ring-black/5 focus:ring-2 focus:ring-[#BFA2DB]"
        />

        <div className="mt-4 grid grid-cols-2 gap-3">
          <div>
            <label className="block text-xs font-medium text-[#333333]/70 mb-1">Mood</label>
            <select
              value={mood}
              onChange={(e) => setMood(e.target.value)}
              className="w-full rounded-2xl bg-white p-2 ring-1 ring-black/5 focus:ring-2 focus:ring-[#BFA2DB]"
            >
              {Object.values(moodPills).map((m) => (
                <option key={m} value={m}>{m}</option>
              ))}
            </select>
          </div>
          <div className="flex items-end gap-2">
            <input id="anon" type="checkbox" checked={anon} onChange={() => setAnon(!anon)} className="h-5 w-5 rounded-md accent-[#A080A8]" />
            <label htmlFor="anon" className="text-sm text-[#333333]">Post anonymously</label>
          </div>
        </div>

        <div className="mt-5 flex justify-end gap-2">
          <button onClick={onClose} className="px-4 py-2 rounded-xl bg-white ring-1 ring-black/5 text-[#333333] hover:shadow-sm">Cancel</button>
          <button
            onClick={() => {
              if (!text.trim()) return;
              onSubmit({ text, mood, anon });
            }}
            className="px-4 py-2 rounded-xl bg-[#A080A8] text-white shadow hover:shadow-md"
          >
            Post
          </button>
        </div>
      </div>
    </div>
  );
}

export default function OpnlyApp() {
  const [query, setQuery] = useState("");
  const [posts, setPosts] = useState(seedPosts);
  const [showCompose, setShowCompose] = useState(false);

  const filtered = useMemo(() => {
    const q = query.toLowerCase();
    if (!q) return posts;
    return posts.filter(
      (p) => p.text.toLowerCase().includes(q) || p.mood.toLowerCase().includes(q)
    );
  }, [query, posts]);

  function handleReact(id, type) {
    if (type !== "like") return;
    setPosts((prev) =>
      prev.map((p) => (p.id === id ? { ...p, likes: p.likes + 1 } : p))
    );
  }

  function handleSubmit({ text, mood, anon }) {
    const newPost = {
      id: Math.max(0, ...posts.map((p) => p.id)) + 1,
      name: anon ? "Anonymous" : "You",
      avatar:
        anon
          ? "https://images.unsplash.com/photo-1511367461989-f85a21fda167?q=80&w=80&h=80&fit=crop&crop=faces"
          : "https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=80&h=80&fit=crop&crop=faces",
      time: "just now",
      text,
      mood,
      likes: 0,
      comments: 0,
    };
    setPosts((prev) => [newPost, ...prev]);
    setShowCompose(false);
  }

  return (
    <div className="min-h-screen bg-[#F7F7F9] text-[#333333]">
      <div
        className="fixed inset-x-0 top-0 -z-10 h-[320px] bg-gradient-to-b from-[#C8A2C8]/40 via-[#BFA2DB]/30 to-transparent"
        aria-hidden
      />

      <Header onLogin={() => {}} onSignup={() => {}} />
      <main className="mx-auto max-w-3xl px-4">
        <Hero />

        <div className="mt-4 mb-3 flex items-center justify-between">
          <h2 className="text-xl font-semibold text-[#333333]">Home</h2>
          <div className="w-40 md:w-64"><SearchBar query={query} setQuery={setQuery} /></div>
        </div>

        <div className="grid gap-4 md:gap-5 mb-24">
          {filtered.map((p) => (
            <PostCard key={p.id} post={p} onReact={handleReact} />
          ))}
        </div>
      </main>

      {/* Floating Compose Button */}
      <button
        onClick={() => setShowCompose(true)}
        className="fixed bottom-5 right-5 md:bottom-8 md:right-8 grid place-items-center w-14 h-14 rounded-full bg-[#A080A8] text-white shadow-xl hover:shadow-2xl active:scale-95 transition"
        aria-label="Create post"
      >
        <IconPencil />
      </button>

      {/* Bottom Nav (app-like) */}
      <nav className="fixed inset-x-0 bottom-0 z-20 mx-auto max-w-3xl bg-white/90 backdrop-blur border-t border-black/5">
        <div className="px-6 py-3 grid grid-cols-3 text-sm">
          <button className="font-semibold text-[#634B73]">Home</button>
          <button className="text-[#333333]/70">Explore</button>
          <button className="text-[#333333]/70">Profile</button>
        </div>
      </nav>

      {showCompose && (
        <Compose onClose={() => setShowCompose(false)} onSubmit={handleSubmit} />
      )}
    </div>
  );
}
